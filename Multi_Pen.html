<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendulum Simulation | Aarav Sinha</title>
    <style>
        :root { --neon: #00f2ff; --bg: #000; --panel: #0d1117; --border: #30363d; --alert: #ff00ff; --accent: #ccff00; }
        * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
        body, html { margin: 0; padding: 0; background: #000; color: #e6edf3; overflow: hidden; height: 100vh; }

        /* IMPROVED SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon); }

        /* WATERMARK STYLE */
        .global-watermark { position: fixed; bottom: 20px; right: 25px; color: rgba(0, 242, 255, 0.15); font-size: 12px; letter-spacing: 4px; pointer-events: none; z-index: 10001; text-transform: uppercase; font-weight: bold; }

        #setup-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #000; z-index: 10000; }
        .init-box { border: 1px solid var(--neon); padding: 40px; text-align: center; background: #0a0a0a; border-radius: 4px; width: 350px; position: relative; }
        
        #lab-screen { display: none; width: 100vw; height: 100vh; flex-direction: row; }
        
        .sidebar { width: 450px; height: 100%; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--panel); z-index: 100; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 15px; }
        
        .card { background: rgba(0,0,0,0.5); border: 1px solid var(--border); padding: 15px; margin-bottom: 20px; border-radius: 4px; position: relative; }
        .card h3 { font-size: 11px; color: var(--neon); letter-spacing: 2px; margin: 0 0 15px 0; border-bottom: 1px solid #222; padding-bottom: 5px; text-transform: uppercase; }
        
        table { width: 100%; border-collapse: collapse; }
        th { font-size: 9px; color: #666; text-align: center; padding-bottom: 10px; text-transform: uppercase; }
        td { padding: 4px 2px; }
        
        .stepper { display: flex; border: 1px solid var(--border); background: #000; border-radius: 2px; height: 28px; width: 100%; }
        .stepper button { width: 25px; background: transparent; border: none; color: var(--neon); cursor: pointer; font-weight: bold; font-size: 14px; }
        .stepper button:hover { background: var(--neon); color: #000; }
        .stepper input { width: 100%; background: transparent; border: none; color: #fff; text-align: center; font-size: 11px; outline: none; }

        .btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--neon); color: var(--neon); cursor: pointer; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-top: 8px; border-radius: 4px; }
        .btn:hover { background: var(--neon); color: #000; }

        #viewport-container { flex-grow: 1; position: relative; background: radial-gradient(circle at center, #0d1117 0%, #000 100%); overflow: hidden; }
        .ruler { position: absolute; background: rgba(5, 5, 5, 0.95); z-index: 50; pointer-events: none; }
        .ruler-h { top: 0; left: 0; width: 100%; height: 25px; border-bottom: 1px solid var(--border); }
        .ruler-v { top: 0; left: 0; width: 25px; height: 100%; border-right: 1px solid var(--border); }
        .tick { position: absolute; background: #333; }
        .tick-label { position: absolute; font-size: 8px; color: #555; }

        #telemetry_overlay { 
            position: absolute; top: 50px; left: 50px; width: 280px; 
            background: rgba(10, 14, 20, 0.95); border: 1px solid var(--neon); 
            z-index: 200; border-radius: 4px; display: none; cursor: move;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }
        .drag-handle { background: var(--neon); color: #000; padding: 6px 10px; font-size: 9px; font-weight: bold; text-transform: uppercase; cursor: move; }

        .stat-block { border-bottom: 1px solid #222; padding: 8px 10px; font-size: 10px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 2px; }
        .stat-val { color: var(--neon); font-weight: bold; }

        canvas { display: block; width: 100%; height: 100%; }
        .extract-btn { position: absolute; top: 12px; right: 15px; font-size: 9px; color: var(--accent); cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

<div id="setup-screen">
    <div class="global-watermark">AARAV SINHA</div>
    <div class="init-box">
        <h1 style="color:var(--neon); letter-spacing:5px; margin-bottom:5px;">PENDULUM SIMULATION</h1>
        <p style="font-size: 9px; color: #444; margin-bottom: 30px; letter-spacing: 2px;">CORE INITIALIZATION</p>
        <label style="font-size: 9px; color: #888;">SELECT BOB QUANTITY</label><br>
        <input type="number" id="n_count" value="3" min="1" max="10" style="background:#000; border:1px solid var(--neon); color:var(--neon); padding:10px; width:80px; text-align:center; font-size: 20px; outline:none; margin-top:5px;">
        <button class="btn" onclick="initLab()" style="margin-top:30px;">INITIALIZE SIMULATION</button>
    </div>
</div>

<div id="lab-screen">
    <div class="global-watermark">AARAV SINHA</div>
    <aside class="sidebar">
        <div class="scroll-area">
            <div class="card">
                <h3>INITIALIZATION</h3>
                <table>
                    <thead><tr><th>BOB</th><th>Length</th><th>Angle°</th><th>Mass</th></tr></thead>
                    <tbody id="unit_tbody"></tbody>
                </table>
            </div>
            
            <div class="card">
                <h3>SIMULATION ENGINE</h3>
                <button class="btn" id="pBtn" onclick="togglePause()">PAUSE ENGINE</button>
                <button class="btn" onclick="buildPhysics()" style="border-color:var(--accent); color:var(--accent);">RESET VECTORS</button>
                <button class="btn" onclick="location.reload()" style="border-color:#444; color:#666;">TERMINATE</button>
            </div>

            <div class="card">
                <h3>ENVIRONMENT</h3>
                <div style="display:flex; justify-content:space-between; font-size:10px; margin-bottom:5px;"><span>GRAVITY (m/s²)</span><span id="gv" style="color:var(--neon)">9.81</span></div>
                <input type="range" id="grv" min="0" max="500" value="98" style="width:100%; accent-color:var(--neon);">
                <div style="display:flex; justify-content:space-between; font-size:10px; margin:15px 0 5px 0;"><span>FRICTION</span><span id="fv" style="color:var(--neon)">0.002</span></div>
                <input type="range" id="fric" min="0" max="0.5" step="0.001" value="0.002" style="width:100%; accent-color:var(--neon);">
            </div>
            
            <div id="sidebar_telem_card" class="card">
                <h3>LIVE TELEMETRY</h3>
                <span class="extract-btn" onclick="extractTelem()">EXTRACT</span>
                <div id="telem_content_sidebar"></div>
            </div>
        </div>
    </aside>

    <main id="viewport-container">
        <div id="telemetry_overlay">
            <div class="drag-handle" id="telem_drag">LIVE DATA (DRAG TO MOVE)</div>
            <div id="telem_content_overlay"></div>
            <button class="btn" onclick="dockTelem()" style="margin:0; border:none; border-top:1px solid #333; border-radius:0; font-size:8px;">DOCK TO SIDEBAR</button>
        </div>
        <div id="rh" class="ruler ruler-h"></div>
        <div id="rv" class="ruler ruler-v"></div>
        <canvas id="canvas"></canvas>
    </main>
</div>

<script>
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    let n, bobs = [], trail = [], paused = false, live = false, drag = null, extracted = false;

    function initLab() {
        n = parseInt(document.getElementById('n_count').value);
        const tbody = document.getElementById('unit_tbody');
        tbody.innerHTML = '';
        for(let i=0; i<n; i++) {
            tbody.innerHTML += `
                <tr>
                    <td style="font-size:10px; color:var(--neon); text-align:center;">#${i+1}</td>
                    <td><div class="stepper"><button onclick="adj('L${i}',-5)">-</button><input type="number" id="L${i}" value="${120-i*10}" oninput="sync()"><button onclick="adj('L${i}',5)">+</button></div></td>
                    <td><div class="stepper"><button onclick="adj('A${i}',-5)">-</button><input type="number" id="A${i}" value="${30+i*20}" oninput="sync()"><button onclick="adj('A${i}',5)">+</button></div></td>
                    <td><div class="stepper"><button onclick="adj('M${i}',-1)">-</button><input type="number" id="M${i}" value="${20+i*5}" oninput="sync()"><button onclick="adj('M${i}',1)">+</button></div></td>
                </tr>`;
        }
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('lab-screen').style.display = 'flex';
        resize(); buildPhysics(); drawRulers(); live = true; loop();
    }

    function adj(id, v) { const el = document.getElementById(id); el.value = parseInt(el.value) + v; sync(); }
    function togglePause() { paused = !paused; document.getElementById('pBtn').innerText = paused ? "RESUME ENGINE" : "PAUSE ENGINE"; }
    
    function extractTelem() { extracted = true; document.getElementById('telemetry_overlay').style.display = 'block'; document.getElementById('sidebar_telem_card').style.opacity = '0.3'; }
    function dockTelem() { extracted = false; document.getElementById('telemetry_overlay').style.display = 'none'; document.getElementById('sidebar_telem_card').style.opacity = '1'; }

    function buildPhysics() {
        bobs = []; trail = [];
        let cx = 0, cy = -150;
        bobs.push({x:0, y:cy, oldX:0, oldY:cy, fixed:true, mass:0, lastAng:0, lastAv:0});
        for(let i=0; i<n; i++) {
            let l = parseFloat(document.getElementById(`L${i}`).value);
            let a = parseFloat(document.getElementById(`A${i}`).value) * Math.PI/180;
            cx += l * Math.sin(a); cy += l * Math.cos(a);
            bobs.push({x:cx, y:cy, oldX:cx, oldY:cy, len:l, mass:parseFloat(document.getElementById(`M${i}`).value), lastAng:a, lastAv:0});
        }
    }

    function sync() { if(paused || !live) buildPhysics(); }

    function drawRulers() {
        const rh = document.getElementById('rh'), rv = document.getElementById('rv');
        rh.innerHTML = ''; rv.innerHTML = '';
        for(let i=0; i<window.innerWidth; i+=50) {
            let m = document.createElement('div'); m.className='tick'; m.style.left=i+'px'; m.style.bottom='0'; m.style.width='1px'; m.style.height=i%100==0?'10px':'5px'; rh.appendChild(m);
            if(i%100==0){ let l=document.createElement('div'); l.className='tick-label'; l.style.left=(i+4)+'px'; l.style.top='5px'; l.innerText=i; rh.appendChild(l); }
        }
        for(let i=0; i<window.innerHeight; i+=50) {
            let m = document.createElement('div'); m.className='tick'; m.style.top=i+'px'; m.style.right='0'; m.style.height='1px'; m.style.width=i%100==0?'10px':'5px'; rv.appendChild(m);
            if(i%100==0){ let l=document.createElement('div'); l.className='tick-label'; l.style.top=(i+2)+'px'; l.style.left='5px'; l.innerText=i; rv.appendChild(l); }
        }
    }

    // Draggable Logic
    const overlay = document.getElementById("telemetry_overlay");
    const dragHandle = document.getElementById("telem_drag");
    let activeDrag = false, initialX, initialY, xOffset = 0, yOffset = 0;

    dragHandle.onmousedown = e => { initialX = e.clientX - xOffset; initialY = e.clientY - yOffset; activeDrag = true; };
    
    window.onmousemove = e => {
        if (activeDrag) {
            xOffset = e.clientX - initialX; yOffset = e.clientY - initialY;
            overlay.style.transform = `translate3d(${xOffset}px, ${yOffset}px, 0)`;
        }
        if(drag) {
            const r = canvas.getBoundingClientRect();
            drag.x = (e.clientX-r.left-canvas.width/2)/1.4; drag.y = (e.clientY-r.top-canvas.height/3)/1.4;
            drag.oldX = drag.x; drag.oldY = drag.y;
            for(let i=1; i<bobs.length; i++) {
                let dx = bobs[i].x-bobs[i-1].x, dy = bobs[i].y-bobs[i-1].y;
                document.getElementById(`L${i-1}`).value = Math.round(Math.sqrt(dx*dx+dy*dy));
                document.getElementById(`A${i-1}`).value = Math.round(Math.atan2(dx,dy)*180/Math.PI);
                bobs[i].len = Math.sqrt(dx*dx+dy*dy);
            }
        }
    };
    window.onmouseup = () => { activeDrag = false; drag = null; };

    canvas.onmousedown = e => {
        const r = canvas.getBoundingClientRect();
        const mx = (e.clientX-r.left-canvas.width/2)/1.4, my = (e.clientY-r.top-canvas.height/3)/1.4;
        bobs.forEach(b => { if(!b.fixed && Math.hypot(b.x-mx, b.y-my) < 30) drag = b; });
    };

    function loop() {
        if(!live) return;
        const g_val = parseFloat(document.getElementById('grv').value);
        const f_val = parseFloat(document.getElementById('fric').value);
        document.getElementById('gv').innerText = (g_val/10).toFixed(2);
        document.getElementById('fv').innerText = f_val.toFixed(3);

        if(!paused && !drag) {
            for(let s=0; s<15; s++) {
                bobs.forEach(b => { if(!b.fixed) {
                    let vx = (b.x-b.oldX)*(1-f_val/15), vy = (b.y-b.oldY)*(1-f_val/15);
                    b.oldX=b.x; b.oldY=b.y; b.x+=vx; b.y+=vy+(g_val/1000);
                }});
                for(let k=0; k<25; k++) {
                    for(let i=1; i<bobs.length; i++) {
                        let p1=bobs[i-1], p2=bobs[i], dx=p2.x-p1.x, dy=p2.y-p1.y, d=Math.sqrt(dx*dx+dy*dy), diff=(p2.len-d)/d;
                        if(!p1.fixed){ p1.x-=dx*diff*0.5; p1.y-=dy*diff*0.5; }
                        p2.x+=dx*diff*0.5; p2.y+=dy*diff*0.5;
                    }
                }
            }
            trail.push({x:bobs[n].x, y:bobs[n].y});
            if(trail.length > 40) trail.shift();
        }

        ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.save(); ctx.translate(canvas.width/2, canvas.height/3); ctx.scale(1.4, 1.4);
        
        ctx.beginPath(); ctx.strokeStyle='rgba(0,242,255,0.4)'; ctx.lineWidth=1;
        trail.forEach((p, idx) => { ctx.globalAlpha = idx / trail.length; ctx.lineTo(p.x, p.y); }); 
        ctx.stroke(); ctx.globalAlpha = 1.0;

        ctx.beginPath(); ctx.strokeStyle='#00f2ff'; ctx.lineWidth=2;
        ctx.moveTo(bobs[0].x, bobs[0].y);
        bobs.forEach(b => ctx.lineTo(b.x, b.y)); ctx.stroke();

        let tHtml = '';
        bobs.forEach((b,i) => {
            let radius = b.fixed ? 5 : Math.sqrt(b.mass) * 3.5;
            ctx.fillStyle = b.fixed ? '#fff' : (drag == b ? '#ff00ff' : '#00f2ff');
            ctx.beginPath(); ctx.arc(b.x, b.y, radius, 0, Math.PI*2); ctx.fill();
            if(i > 0) {
                ctx.fillStyle = "#000"; ctx.font = "bold 9px JetBrains Mono"; ctx.textAlign = "center";
                ctx.fillText(i, b.x, b.y+1);
                
                let ang = Math.atan2(b.x - bobs[i-1].x, b.y - bobs[i-1].y);
                let av = (ang - b.lastAng) * 60; let aa = (av - b.lastAv) * 60;
                b.lastAng = ang; b.lastAv = av;
                let vel = Math.hypot(b.x - b.oldX, b.y - b.oldY) * 60;
                let ke = 0.5 * b.mass * vel * vel;
                let pe = b.mass * (g_val/10) * ((bobs[0].y + 500) - b.y);
                let tp = 2 * Math.PI * Math.sqrt(b.len / (g_val/10 || 0.1));

                tHtml += `<div class="stat-block">
                    <div class="stat-row"><span>BOB #${i}</span><span class="stat-val">${(ang*180/Math.PI).toFixed(1)}°</span></div>
                    <div class="stat-row"><span>ω | α</span><span class="stat-val">${av.toFixed(2)} | ${aa.toFixed(2)}</span></div>
                    <div class="stat-row"><span>KE | PE</span><span class="stat-val" style="color:var(--accent)">${(ke/1000).toFixed(1)} | ${(pe/1000).toFixed(1)}</span></div>
                    <div class="stat-row"><span>T(s)</span><span class="stat-val">${tp.toFixed(2)}s</span></div>
                </div>`;
            }
        });
        ctx.restore();
        document.getElementById(extracted ? 'telem_content_overlay' : 'telem_content_sidebar').innerHTML = tHtml;
        requestAnimationFrame(loop);
    }
    function resize() { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; drawRulers(); }
    window.onresize = resize;
</script>
</body>
</html>